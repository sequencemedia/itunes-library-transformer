"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.transformPlaylistsToM3U8=void 0;var _fs=require("fs");var _path=require("path");var _fsExtra=require("fs-extra");var _querystring=require("querystring");var _itunesLibraryStream=require("@sequencemedia/itunes-library-stream");var _common=require("./common");const transformPlaylistsToM3U8=(destination,ext)=>({[_itunesLibraryStream.LIBRARY]:library})=>{if(library){const tracks=library.get('Tracks');const playlists=library.get('Playlists');Array.from(playlists).filter(_common.filterPlaylists).forEach(playlist=>{const filePath=(0,_path.resolve)(`${destination}/Playlists/${(0,_common.getFilePath)(playlist,playlists)}.${ext}`);(0,_fsExtra.ensureFile)(filePath,e=>{if(e){console.error(e);}else{const fileData=Array.from(playlist.get('Playlist Items')).map(item=>{const id=item.get('Track ID');const track=tracks.get(id);const time=parseInt(track.get('Total Time')/1000,10)||-1;const name=track.get('Name');const artist=track.get('Artist')||track.get('Album Artist');const file=(0,_querystring.unescape)((track.get('Location')||'').replace('file://',''));return`#EXTINF:${time},${name} - ${artist}\n${file}`;});(0,_fs.writeFile)(filePath,`#EXTM3U\n${fileData.join('\n')}`,'utf8',e=>{if(e){console.error(e);}});}});});}};exports.transformPlaylistsToM3U8=transformPlaylistsToM3U8;